\hypertarget{main__server_8hpp_source}{}\doxysection{main\+\_\+server.\+hpp}
\label{main__server_8hpp_source}\index{dhtt/include/dhtt/server/main\_server.hpp@{dhtt/include/dhtt/server/main\_server.hpp}}
\mbox{\hyperlink{main__server_8hpp}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{1 \textcolor{preprocessor}{\#ifndef MAIN\_SERVER\_HPP}}
\DoxyCodeLine{2 \textcolor{preprocessor}{\#define MAIN\_SERVER\_HPP}}
\DoxyCodeLine{3 }
\DoxyCodeLine{4 \textcolor{comment}{// cpp includes}}
\DoxyCodeLine{5 \textcolor{preprocessor}{\#include <string.h>}}
\DoxyCodeLine{6 \textcolor{preprocessor}{\#include <iostream>}}
\DoxyCodeLine{7 \textcolor{preprocessor}{\#include <experimental/filesystem>}}
\DoxyCodeLine{8 }
\DoxyCodeLine{9 \textcolor{comment}{// yaml-\/cpp includes}}
\DoxyCodeLine{10 \textcolor{preprocessor}{\#include "{}yaml-\/cpp/yaml.h"{}}}
\DoxyCodeLine{11 \textcolor{preprocessor}{\#include "{}yaml-\/cpp/exceptions.h"{}}}
\DoxyCodeLine{12 }
\DoxyCodeLine{13 \textcolor{comment}{// boost includes}}
\DoxyCodeLine{14 \textcolor{preprocessor}{\#include "{}boost/thread/mutex.hpp"{}}}
\DoxyCodeLine{15 }
\DoxyCodeLine{16 \textcolor{comment}{// ros2 includes}}
\DoxyCodeLine{17 \textcolor{preprocessor}{\#include "{}rclcpp/rclcpp.hpp"{}}}
\DoxyCodeLine{18 \textcolor{preprocessor}{\#include "{}rclcpp\_action/rclcpp\_action.hpp"{}}}
\DoxyCodeLine{19 }
\DoxyCodeLine{20 \textcolor{comment}{// dhtt includes}}
\DoxyCodeLine{21 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{node_8hpp}{dhtt/tree/node.hpp}}"{}}}
\DoxyCodeLine{22 }
\DoxyCodeLine{23 \textcolor{comment}{// dhtt message includes}}
\DoxyCodeLine{24 \textcolor{preprocessor}{\#include "{}dhtt\_msgs/msg/node.hpp"{}}}
\DoxyCodeLine{25 \textcolor{preprocessor}{\#include "{}dhtt\_msgs/msg/node\_status.hpp"{}}}
\DoxyCodeLine{26 \textcolor{preprocessor}{\#include "{}dhtt\_msgs/msg/resource.hpp"{}}}
\DoxyCodeLine{27 \textcolor{preprocessor}{\#include "{}dhtt\_msgs/msg/subtree.hpp"{}}}
\DoxyCodeLine{28 }
\DoxyCodeLine{29 \textcolor{comment}{// dhtt srv includes}}
\DoxyCodeLine{30 \textcolor{preprocessor}{\#include "{}dhtt\_msgs/srv/control\_request.hpp"{}}}
\DoxyCodeLine{31 \textcolor{preprocessor}{\#include "{}dhtt\_msgs/srv/fetch\_request.hpp"{}}}
\DoxyCodeLine{32 \textcolor{preprocessor}{\#include "{}dhtt\_msgs/srv/modify\_request.hpp"{}}}
\DoxyCodeLine{33 \textcolor{preprocessor}{\#include "{}dhtt\_msgs/srv/history\_request.hpp"{}}}
\DoxyCodeLine{34 \textcolor{preprocessor}{\#include "{}dhtt\_msgs/srv/internal\_control\_request.hpp"{}}}
\DoxyCodeLine{35 \textcolor{preprocessor}{\#include "{}dhtt\_msgs/srv/internal\_modify\_request.hpp"{}}}
\DoxyCodeLine{36 \textcolor{preprocessor}{\#include "{}dhtt\_msgs/srv/internal\_service\_registration.hpp"{}}}
\DoxyCodeLine{37 }
\DoxyCodeLine{38 \textcolor{comment}{// dhtt action includes}}
\DoxyCodeLine{39 \textcolor{preprocessor}{\#include "{}dhtt\_msgs/action/activation.hpp"{}}}
\DoxyCodeLine{40 }
\DoxyCodeLine{41 \textcolor{comment}{// helpful constants}}
\DoxyCodeLine{42 \textcolor{preprocessor}{\#define MAX\_NODE\_NUM 1000}}
\DoxyCodeLine{43 \textcolor{preprocessor}{\#define FAILED "{}failed"{}}}
\DoxyCodeLine{44 \textcolor{preprocessor}{\#define ROOT\_PARENT -\/1}}
\DoxyCodeLine{45 \textcolor{preprocessor}{\#define ROOT\_PARENT\_NAME "{}NONE"{}}}
\DoxyCodeLine{46 }
\DoxyCodeLine{47 \textcolor{keyword}{namespace }\mbox{\hyperlink{namespacedhtt}{dhtt}}}
\DoxyCodeLine{48 \{}
\DoxyCodeLine{58     \textcolor{keyword}{class }\mbox{\hyperlink{classdhtt_1_1MainServer}{MainServer}} : \textcolor{keyword}{public} rclcpp::Node}
\DoxyCodeLine{59     \{}
\DoxyCodeLine{60     \textcolor{keyword}{public}:}
\DoxyCodeLine{67         \mbox{\hyperlink{classdhtt_1_1MainServer_a79c34c695e51e387b1afb1ce0dd84ae0}{MainServer}}(std::string node\_name, std::shared\_ptr<rclcpp::executors::MultiThreadedExecutor> spinner);}
\DoxyCodeLine{68         \mbox{\hyperlink{classdhtt_1_1MainServer_a4cb4032ccc5d22e5fc85d5846c4579a8}{\string~MainServer}}();}
\DoxyCodeLine{69 }
\DoxyCodeLine{70     \textcolor{keyword}{private}:}
\DoxyCodeLine{71 }
\DoxyCodeLine{72         \textcolor{comment}{// *** PRIVATE MEMBER FUNCTIONS ***}}
\DoxyCodeLine{73         \textcolor{comment}{// server callbacks}}
\DoxyCodeLine{77 \textcolor{comment}{}        \textcolor{keywordtype}{void} \mbox{\hyperlink{classdhtt_1_1MainServer_a5baef94ba95d5800a20424cf6ae0ea18}{modify\_callback}}( \textcolor{keyword}{const} std::shared\_ptr<dhtt\_msgs::srv::ModifyRequest::Request> request, std::shared\_ptr<dhtt\_msgs::srv::ModifyRequest::Response> response );}
\DoxyCodeLine{78 }
\DoxyCodeLine{82         \textcolor{keywordtype}{void} \mbox{\hyperlink{classdhtt_1_1MainServer_a305d4682414cf86aa02193467007b23c}{control\_callback}}( \textcolor{keyword}{const} std::shared\_ptr<dhtt\_msgs::srv::ControlRequest::Request> request, std::shared\_ptr<dhtt\_msgs::srv::ControlRequest::Response> response );}
\DoxyCodeLine{83 }
\DoxyCodeLine{87         \textcolor{keywordtype}{void} \mbox{\hyperlink{classdhtt_1_1MainServer_a61792024c9057d85558c9b129bcfad34}{fetch\_callback}}( \textcolor{keyword}{const} std::shared\_ptr<dhtt\_msgs::srv::FetchRequest::Request> request, std::shared\_ptr<dhtt\_msgs::srv::FetchRequest::Response> response );}
\DoxyCodeLine{88 }
\DoxyCodeLine{92         \textcolor{keywordtype}{void} \mbox{\hyperlink{classdhtt_1_1MainServer_a8f2558f1d98c5f2388a0935469eb6935}{history\_callback}}( \textcolor{keyword}{const} std::shared\_ptr<dhtt\_msgs::srv::HistoryRequest::Request> request, std::shared\_ptr<dhtt\_msgs::srv::HistoryRequest::Response> response );}
\DoxyCodeLine{93 }
\DoxyCodeLine{94         \textcolor{comment}{// modify helpers}}
\DoxyCodeLine{107 \textcolor{comment}{}        std::string \mbox{\hyperlink{classdhtt_1_1MainServer_a2dce91b70003524c39f9425c0ed7ecca}{add\_node}}( std::shared\_ptr<dhtt\_msgs::srv::ModifyRequest::Response> response, std::string parent\_name, dhtt\_msgs::msg::Node to\_add );}
\DoxyCodeLine{108 }
\DoxyCodeLine{121         std::string \mbox{\hyperlink{classdhtt_1_1MainServer_a9e728cbb985a54de271a01a1f0d2b3ce}{add\_nodes\_from\_file}}( std::shared\_ptr<dhtt\_msgs::srv::ModifyRequest::Response> response, std::string parent\_name, std::string file\_name );}
\DoxyCodeLine{122 }
\DoxyCodeLine{134         std::string \mbox{\hyperlink{classdhtt_1_1MainServer_a7043583ea0451e54fdc3fa164adf4c40}{remove\_node}}( \textcolor{keyword}{const} std::shared\_ptr<dhtt\_msgs::srv::ModifyRequest::Response> response, std::string to\_remove );}
\DoxyCodeLine{135 }
\DoxyCodeLine{143         std::string \mbox{\hyperlink{classdhtt_1_1MainServer_ae40d57d6711240dd4e603d6aa4259d5d}{change\_params}}( \textcolor{keyword}{const} std::shared\_ptr<dhtt\_msgs::srv::ModifyRequest::Request> request );}
\DoxyCodeLine{144 }
\DoxyCodeLine{145         \textcolor{comment}{// control helpers}}
\DoxyCodeLine{146 }
\DoxyCodeLine{156         std::string \mbox{\hyperlink{classdhtt_1_1MainServer_a669b9175b3a76523c73c2635d265de6d}{stop\_tree}}( \textcolor{keywordtype}{bool} interrupt );}
\DoxyCodeLine{157 }
\DoxyCodeLine{165         std::string \mbox{\hyperlink{classdhtt_1_1MainServer_ad7cc8b0a9ea7eddd75f31e15489c04fe}{start\_tree}}();}
\DoxyCodeLine{166 }
\DoxyCodeLine{174         std::string \mbox{\hyperlink{classdhtt_1_1MainServer_a2a72c0e39f43bb2ce066d7de9f2d12f5}{save\_tree}}();}
\DoxyCodeLine{175 }
\DoxyCodeLine{183         std::string \mbox{\hyperlink{classdhtt_1_1MainServer_a5ad2e6bea01a93bb8a7dd17cc2f82746}{reset\_tree}}();}
\DoxyCodeLine{184 }
\DoxyCodeLine{185         \textcolor{comment}{// fetch helpers}}
\DoxyCodeLine{186 }
\DoxyCodeLine{197         std::vector<dhtt\_msgs::msg::Subtree> \mbox{\hyperlink{classdhtt_1_1MainServer_a0e3e7c6bcb4ab30a474c4111e2010c44}{fetch\_subtrees\_by\_common\_name}}( std::string name );}
\DoxyCodeLine{198 }
\DoxyCodeLine{209         std::vector<dhtt\_msgs::msg::Subtree> \mbox{\hyperlink{classdhtt_1_1MainServer_a10af7fcbfd90e381c4403463af808469}{fetch\_subtrees\_by\_type}}( \textcolor{keywordtype}{int} type );}
\DoxyCodeLine{210 }
\DoxyCodeLine{221         dhtt\_msgs::msg::Subtree \mbox{\hyperlink{classdhtt_1_1MainServer_aa771d513effe038bc986e5a1728f28a1}{fetch\_subtree\_by\_name}}( std::string name );}
\DoxyCodeLine{222 }
\DoxyCodeLine{223         \textcolor{comment}{// subscriber callbacks}}
\DoxyCodeLine{234 \textcolor{comment}{}        \textcolor{keywordtype}{void} \mbox{\hyperlink{classdhtt_1_1MainServer_a52c8c63c817455fa2493b257f3dc3c4b}{status\_callback}}( \textcolor{keyword}{const} std::shared\_ptr<dhtt\_msgs::msg::Node> data );}
\DoxyCodeLine{235 }
\DoxyCodeLine{236         \textcolor{comment}{// generally helpful functions}}
\DoxyCodeLine{244 \textcolor{comment}{}        \textcolor{keywordtype}{void} \mbox{\hyperlink{classdhtt_1_1MainServer_aa6e75a9bfd55c282262d322ffa5934d3}{maintain\_local\_subtree}}();}
\DoxyCodeLine{245 }
\DoxyCodeLine{255         \textcolor{keywordtype}{void} \mbox{\hyperlink{classdhtt_1_1MainServer_aa995061166ab0db237214be402a0740a}{fill\_subtree\_metrics}}( dhtt\_msgs::msg::Subtree\& to\_fill );}
\DoxyCodeLine{256 }
\DoxyCodeLine{264         \textcolor{keywordtype}{void} \mbox{\hyperlink{classdhtt_1_1MainServer_aa801ca3cae4f4adcb5617e26a430186f}{run\_tree}}();}
\DoxyCodeLine{265 }
\DoxyCodeLine{273         \textcolor{keywordtype}{void} \mbox{\hyperlink{classdhtt_1_1MainServer_ae06850b2b26f2d2e7dc8d71423665f39}{tree\_result\_callback}}( \textcolor{keyword}{const} rclcpp\_action::ClientGoalHandle<dhtt\_msgs::action::Activation>::WrappedResult \& result);}
\DoxyCodeLine{274 }
\DoxyCodeLine{283         \textcolor{keywordtype}{void} \mbox{\hyperlink{classdhtt_1_1MainServer_a009a5881194ade8cf65fea8c1d4561ae}{publish\_root\_status}}();}
\DoxyCodeLine{284 }
\DoxyCodeLine{292         dhtt\_msgs::msg::Node \mbox{\hyperlink{classdhtt_1_1MainServer_a465a54116a7482d34bd739129a32d05c}{get\_active\_behavior\_node}}();}
\DoxyCodeLine{293 }
\DoxyCodeLine{301         std::vector<dhtt\_msgs::msg::Node> \mbox{\hyperlink{classdhtt_1_1MainServer_ac389893f1ef1e0c6d05fa7b09673e0b3}{get\_active\_nodes}}();}
\DoxyCodeLine{302 }
\DoxyCodeLine{312         dhtt\_msgs::msg::Subtree \mbox{\hyperlink{classdhtt_1_1MainServer_aaca8d1df11ec698b7b5761c38639b8bd}{construct\_subtree\_from\_node\_iter}}( std::vector<dhtt\_msgs::msg::Node>::iterator top\_node );}
\DoxyCodeLine{313 }
\DoxyCodeLine{314         \textcolor{comment}{// *** PRIVATE MEMBERS ***}}
\DoxyCodeLine{315         \textcolor{comment}{// external services}}
\DoxyCodeLine{316         rclcpp::Service<dhtt\_msgs::srv::ModifyRequest>::SharedPtr \mbox{\hyperlink{classdhtt_1_1MainServer_aa1b02dde668cf184e3a01685335dedf6}{modify\_server}};}
\DoxyCodeLine{317         rclcpp::Service<dhtt\_msgs::srv::ControlRequest>::SharedPtr \mbox{\hyperlink{classdhtt_1_1MainServer_a3d47c114329b812188850b3024d758fd}{control\_server}};}
\DoxyCodeLine{318         rclcpp::Service<dhtt\_msgs::srv::FetchRequest>::SharedPtr \mbox{\hyperlink{classdhtt_1_1MainServer_a4774ab8f47ee4ecaa2652db2027ef1cc}{fetch\_server}};}
\DoxyCodeLine{319         rclcpp::Service<dhtt\_msgs::srv::HistoryRequest>::SharedPtr \mbox{\hyperlink{classdhtt_1_1MainServer_a1adbe3100452f96c256ffcf8ee1e403f}{history\_server}};}
\DoxyCodeLine{320 }
\DoxyCodeLine{321         \textcolor{comment}{// publishers}}
\DoxyCodeLine{322         rclcpp::Publisher<dhtt\_msgs::msg::NodeStatus>::SharedPtr \mbox{\hyperlink{classdhtt_1_1MainServer_a3db453527ebe9fbb960649f529098cec}{root\_status\_pub}};}
\DoxyCodeLine{323 }
\DoxyCodeLine{324         \textcolor{comment}{// internal subscribers}}
\DoxyCodeLine{325         rclcpp::Subscription<dhtt\_msgs::msg::Node>::SharedPtr \mbox{\hyperlink{classdhtt_1_1MainServer_a8c4025076fe2b03cf2692e6ed3c26c05}{status\_sub}};}
\DoxyCodeLine{326 }
\DoxyCodeLine{327         rclcpp\_action::Client<dhtt\_msgs::action::Activation>::SharedPtr \mbox{\hyperlink{classdhtt_1_1MainServer_ae55dbb2e55fd4f94237a91d4bc1b537d}{client\_ptr}};}
\DoxyCodeLine{328         rclcpp::Client<dhtt\_msgs::srv::InternalControlRequest>::SharedPtr \mbox{\hyperlink{classdhtt_1_1MainServer_a97bd436d74aaebe3a4801c392ae8cdc2}{internal\_control\_client}};}
\DoxyCodeLine{329 }
\DoxyCodeLine{330         \textcolor{comment}{// mutexes}}
\DoxyCodeLine{331         boost::mutex \mbox{\hyperlink{classdhtt_1_1MainServer_ad63cd9dd8e4454f874424025e06c64ed}{modify\_mut}};}
\DoxyCodeLine{332         boost::mutex \mbox{\hyperlink{classdhtt_1_1MainServer_abbe7a0ea592dc0dbb7acd9da9e4c8b7d}{running\_mut}};}
\DoxyCodeLine{333 }
\DoxyCodeLine{334         \textcolor{comment}{// members}}
\DoxyCodeLine{335         std::map<std::string, std::shared\_ptr<dhtt::Node>> \mbox{\hyperlink{classdhtt_1_1MainServer_a9d6a69f832b19159aed48d7b78c7afd4}{node\_map}}; }
\DoxyCodeLine{336         dhtt\_msgs::msg::Subtree \mbox{\hyperlink{classdhtt_1_1MainServer_a0785b9f6450a5aa44ef3d1386179e6d1}{node\_list}}; }
\DoxyCodeLine{337 }
\DoxyCodeLine{338         std::shared\_ptr<std::thread> \mbox{\hyperlink{classdhtt_1_1MainServer_a32c91656658edf862ab4953bafbd5f01}{run\_tree\_thread}};}
\DoxyCodeLine{339 }
\DoxyCodeLine{340         std::list<std::string> \mbox{\hyperlink{classdhtt_1_1MainServer_a09b7af60f180c4a2884834a5045030cf}{history}};}
\DoxyCodeLine{341 }
\DoxyCodeLine{342         \textcolor{comment}{// this is passed in from main through the constructor so that any inner nodes can be spun as well}}
\DoxyCodeLine{343         std::shared\_ptr<rclcpp::executors::MultiThreadedExecutor> \mbox{\hyperlink{classdhtt_1_1MainServer_a8597f5377a68158e6176af833ed49a3a}{spinner\_cp}};}
\DoxyCodeLine{344 }
\DoxyCodeLine{345         \textcolor{keywordtype}{int} \mbox{\hyperlink{classdhtt_1_1MainServer_acbb04ecf855a277a08cb75f853a29ec0}{total\_nodes\_added}};}
\DoxyCodeLine{346         \textcolor{keywordtype}{bool} \mbox{\hyperlink{classdhtt_1_1MainServer_a760368e748f42ff110b41093dd644c2a}{verbose}};}
\DoxyCodeLine{347         \textcolor{keywordtype}{bool} \mbox{\hyperlink{classdhtt_1_1MainServer_a7dbbf6c6d913289a4ee63b82488cab13}{running}};}
\DoxyCodeLine{348     \};}
\DoxyCodeLine{349 }
\DoxyCodeLine{350 \}}
\DoxyCodeLine{351 }
\DoxyCodeLine{352 \textcolor{preprocessor}{\#endif }\textcolor{comment}{//MAIN\_SERVER\_HPP}}

\end{DoxyCode}
